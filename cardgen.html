<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Robot Player-Card Generator</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f4f7fa;
      padding: 2rem;
      line-height: 1.4;
    }

    h1 {
      font-size: 1.75rem;
      margin-bottom: 1rem;
    }

    .preview-wrapper {
      margin-bottom: 1rem;
    }

    /* ── Card ───────────────────────────────────────── */
    .card {
      width: 320px;
      padding: 1rem 1.25rem;
      border-radius: 1rem;
      background: #fff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border: 4px solid transparent;
      transition: border-color 0.3s ease;
    }

    .card h2 {
      font-size: 1.35rem;
      margin: 0 0 0.5rem;
      word-break: break-word;
    }

    .stats p {
      display: flex;
      justify-content: space-between;
      margin: 0.15rem 0;
    }

    /* ── Buttons ────────────────────────────────────── */
    button {
      padding: 0.55rem 1rem;
      border: none;
      border-radius: 0.6rem;
      font-size: 0.95rem;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: transform 0.08s ease;
    }
    button:hover {
      transform: translateY(-2px);
    }
    /* Preview button removed */
    #download-btn {
      background: #10b981;
      color: #fff;
      display: inline-block;
    }
  </style>

  <!-- html2canvas for PNG download -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- Shared helpers provided by your site -->
  <script src="shared.js"></script>
</head>
<body>
  <h1>Robot Player-Card Generator</h1>

  <div class="preview-wrapper">
    <div id="card" class="card">
      <h2 id="robot-name">My Awesome Bot</h2>
      <div class="stats" id="stats"><!-- Injected here --></div>
    </div>
  </div>

  <button id="download-btn">Download PNG</button>

  <script>
    /*
      Assumes the following functions are available from shared.js:
        - getScore(gameID)          → Number
        - hslToRgb(h, s, l)         → [r, g, b]
        - rgbToHsl(r, g, b)         → [h, s, l]
    */

    const GAME_IDS = [1, 2, 3, 4];

    /** Utility: builds a single stat line */
    function statLine(label, value) {
      const p = document.createElement("p");
      p.innerHTML = `<span>${label}</span><span>${value}</span>`;
      return p;
    }

    /** Populates the card with current scores */
    function buildCard() {
      const statsEl = document.getElementById("stats");
      statsEl.innerHTML = ""; // Clear previous

      let total = 0;
      GAME_IDS.forEach((id) => {
        const score = getScore(id) || 0;
        total += score;
        statsEl.appendChild(statLine(`Game ${id}`, score));
      });
      statsEl.appendChild(statLine("<strong>Total</strong>", `<strong>${total}</strong>`));

      // Color theme — map total score (0-400) onto hue (0-120)
      const hue = Math.max(0, Math.min(120, total));
      const [r, g, b] = hslToRgb(hue / 360, 0.65, 0.5);
      const borderColor = `rgb(${r}, ${g}, ${b})`;
      document.getElementById("card").style.borderColor = borderColor;
    }

    // ── Initialize and periodic updates ───────────────
    buildCard();
    setInterval(buildCard, 60000); // update every minute

    document.getElementById("download-btn").addEventListener("click", () => {
      html2canvas(document.getElementById("card"), { scale: 2 }).then((canvas) => {
        const link = document.createElement("a");
        link.download = "robot_card.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    });
  </script>
</body>
</html>
